<!DOCTYPE html>
{% load static %}

<html>
<head>
    <script src="https://kit.fontawesome.com/0d16ee4359.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <title>Video Akışı ve Fotoğraf Çekimi</title>
    <link rel="stylesheet" href="{% static 'css/tw.css' %} ">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</head>
<body class="bg-[#43658B]">
    <div class="container flex items-center justify-center">
        <div class="card w-fit mt-9 p-3 flex items-center ">
            <h5 class="text-3xl text-gray-700">EHT</h5>
            <div id="succses-message" style="color: white; display: none; z-index: 999; " class="bg-green-500  absolute text-center p-2  w-full">Yüz tespit edildi.</div>
            <div id="error-message" style="color: white; display: none; z-index: 999; " class="bg-red-500  absolute text-center p-2  w-full">Yüz tespit edilemedi.</div>
            <div class="w-[94.5%] border-opacity-40 sm:mt-[46px] h-[75.9%] absolute border-b-[10px] border-x-[40px] border-t-[40px] border-solid border-[#FD5959]">
                <div class="absolute bg-opacity-40 text-center w-full p-3 bottom-0 bg-[#FD5959] text-white font-bold">
                    Align Boxes then Capture
                </div>
            </div>
            <img id="captured-image" class="border-2 border-blue-300 border-dashed w-[650px] h-[490px]" src="" alt="Captured Photo" style="display: none;"  >
            <video class="border-2 border-blue-300 border-dashed " id="video-stream"  class="border-2 border-blue-300 border-dashed " width="640" height="580" autoplay></video>
            <button class="mt-4 bg-[#EE6F57]  hover:bg-red-500 text-white font-bold py-2 px-4 border-b-4 border-red-700 hover:border-red-500 rounded "  onclick="capturePhoto()"><i class="fa fa-camera text-xl mx-3" aria-hidden="true"></i>Capture Photo</button>
            
            <!-- Görüntülenen fotoğraf için img etiketi ekleyelim -->
  
            
        </div>
    </div>


    <!-- İlgili formun varsayılan olarak gizli olması için style ekleniyor -->
    <div class="form absolute left-[50%] top-[30%]" style="display: none;">
        <form>
            <h4>We’ll send your simulation link</h4>
            <div class="mb-6">
                <label for="text" class="block mb-2 text-sm font-medium text-gray-600 dark:text-white">Name</label>
                <input type="text" id="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Kane" required>
            </div>
            <div class="mb-6">
                <label for="email" class="block mb-2 text-sm font-medium text-gray-600 dark:text-white">Your email</label>
                <input type="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="name@flowbite.com" required>
            </div>
            <div class="mb-6">
                <label for="text" class="block mb-2 text-sm font-medium text-gray-600 dark:text-white">Phone</label>
                <input type="tel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" id="exampleFormControlInputTel" placeholder="Phone" />
            </div>
            <button type="submit" id="capture-button" class="duration-300 text-white bg-[#FF6969] hover:bg-orange-600 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center ">Send</button>
        </form>
    </div>
    <script>
        function capturePhoto() {
            fetch('{% url 'capture_photo' %}')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        // Hata var, hata mesajını göster
                        const errorMessage = document.getElementById('error-message');
                        errorMessage.style.display = 'block';
                        const succsesMessage = document.getElementById('succses-message');
                        succsesMessage.style.display = 'none';
                    } else {
                        // Hata yok, çekilen fotoğrafı video alanında göster
                        const video = document.getElementById('video-stream');
                        video.style.display = 'none'; // Videoyu gizle
                        const capturedImage = document.getElementById('captured-image');
                        capturedImage.src = data.image; // Çekilen fotoğrafı görüntüle
                        capturedImage.style.display = 'block'; // Fotoğrafı göster
                        const errorMessage = document.getElementById('error-message');
                        errorMessage.style.display = 'none';
                        const succsesMessage = document.getElementById('succses-message');
                        succsesMessage.style.display = 'block';
                        
                        // Formu gizlemek ve göstermek için fonksiyon
                        function toggleFormVisibility() {
                            const formElement = document.querySelector('.form');
                            formElement.style.display = formElement.style.display === 'none' ? 'block' : 'none';
                        }

                        // "Capture Photo" butonuna tıklanınca formun görünürlüğünü değiştir
                        const captureButton = document.getElementById('capture-button');
                        captureButton.addEventListener('click', toggleFormVisibility);
                        
                    }
                })
                .catch(error => {
                    console.error('Hata:', error);
                });
        }
    
        const video = document.getElementById('video-stream');
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                })
                .catch(error => {
                    console.error('Kamera erişimi hatası:', error);
                })
        }
        
    </script>
</body>
</html>
